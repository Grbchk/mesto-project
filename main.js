(()=>{"use strict";var t={profileTitle:".profile__title",profileSubtitle:".profile__subtitle",profileEditButton:".profile__button-edit",popupProfile:"#add-profile",popupProfileTitle:"#popup-profile-title",popupProfileSubtitle:"#popup-profile-subtitle",avatarEditButton:".profile__photo-edit",avatarImage:".profile__photo",popupAvatar:"#update-avatar",popupAvatarTitle:"#popup-avatar-url"},e={cardItem:".photo-card",cardTitle:".photo-card__title",cardImage:".photo-card__image",heartButton:".photo-card__button-heart",heartCounter:".photo-card__heart-counter",deleteButton:".photo-card__button-delete",popupViewingPhoto:".viewing-photo",popupAddPhoto:"#add-photo-card",popupTitle:"#popup-photo-title ",popupImageLink:"#popup-photo-subtitle",photoCardPlace:".photo-grid__list"},n={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_visible"},o=["formSelector"];var r,c=function(t,e,n){var o=Object.assign({},n);t.classList.remove(o.inputErrorClass),e.classList.remove(o.errorClass),e.textContent=""},a=function(t,e){var n=Object.assign({},e),o=Array.from(t.querySelectorAll(n.inputSelector)),r=t.querySelector(n.submitButtonSelector);!function(t){return t.some((function(t){return!t.validity.valid}))}(o)?(r.removeAttribute("disabled"),r.classList.remove(n.inactiveButtonClass)):(r.setAttribute("disabled",!0),r.classList.add(n.inactiveButtonClass))},i=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},u=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",f),document.addEventListener("mousedown",v)},s=function(t){var e=t.querySelector(".popup__form");e.reset(),function(t,e){var n=Object.assign({},e);Array.from(t.querySelectorAll(n.inputSelector)).forEach((function(e){var o=t.querySelector(".".concat(e.id,"-error"));c(e,o,n)}))}(e,n)},l=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",f),document.removeEventListener("mousedown",v)},p=function(t){t.textContent="".concat(t.textContent,"...")},d=function(t){t.querySelector(".popup__close-button").addEventListener("click",(function(){l(t)}))},f=function(){"Escape"===event.key&&l(document.querySelector(".popup_opened"))},v=function(){event.target.classList.contains("popup_opened")&&l(document.querySelector(".popup_opened"))},h=function(t,e,n){e.textContent=t.name,n.textContent=t.about},m=function(t,e){var o=Object.assign({},e),r=document.querySelector(o.popupProfile),c=r.querySelector(".popup__form"),i=c.querySelector(o.popupProfileTitle),s=c.querySelector(o.popupProfileSubtitle),f=document.querySelector(o.profileTitle),v=document.querySelector(o.profileSubtitle);h(t,f,v),function(t,e,o,r,c,i,s){var l=Object.assign({},s);document.querySelector(l.profileEditButton).addEventListener("click",(function(){o.value=c.textContent,r.value=i.textContent,a(e,n),u(t)}))}(r,c,i,s,f,v,o),function(t,e,n,o,r,c){d(t),e.addEventListener("submit",(function(a){var i=e.querySelector(".popup__button");!function(t,e,n,o,r,c,a){L(o,r).then((function(t){h(t,c,a)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t,l(n)}))}(i.textContent,i,t,n,o,r,c),a.preventDefault(),p(i)}))}(r,c,i,s,f,v)},_=function(t,e){e.src=t.avatar},b=function(t,e){var o=Object.assign({},e),r=document.querySelector(o.popupAvatar),c=r.querySelector(".popup__form"),i=c.querySelector(o.popupAvatarTitle),f=document.querySelector(o.avatarImage);_(t,f),function(t,e,o){var r=Object.assign({},o);document.querySelector(r.avatarEditButton).addEventListener("click",(function(){a(e,n),s(t),u(t)}))}(r,c,o),function(t,e,n,o){d(t),e.addEventListener("submit",(function(r){var c=e.querySelector(".popup__button");!function(t,e,n,o,r){C(o).then((function(t){_(t,r)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t,s(n),l(n)}))}(c.textContent,c,t,n,o),r.preventDefault(),p(c)}))}(r,c,i,f)},y=function(t,e,n){var o=Object.assign({},n),r=t.querySelector(o.heartCounter),c=e.likes.length;c>0?(r.classList.add("".concat(o.heartCounter,"_active")),r.textContent=c):(r.classList.remove("".concat(o.heartCounter,"_active")),r.textContent="")},S=function(t,e,n,o){var r=Object.assign({},o);t.querySelector(r.heartButton).addEventListener("click",(function(o){!function(t,e,n,o,r){var c=Object.assign({},r);A().then((function(r){var a=r.filter((function(t){if(t._id===e._id)return t}));!function(t,e,n,o,r){var c=Object.assign({},r);e.likes.some((function(t){return t._id===o._id}))?function(t,e,n,o){var r=Object.assign({},o);P(e._id).then((function(e){y(n,e,r),t.classList.remove("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,n,c):function(t,e,n,o){var r=Object.assign({},o);k(e._id).then((function(e){y(n,e,r),t.classList.add("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,n,c)}(t,a[0],n,o,c)})).catch((function(t){console.log(t)}))}(o.target,e,t,n,r)}))},g=function(t,e,n,o,r){var c=Object.assign({},r);!function(t,e,n,o){var r=Object.assign({},o);if(e.likes.length>0){var c=t.querySelector(r.heartButton);e.likes.forEach((function(t){t._id===n._id&&c.classList.add("photo-card__button-heart_active")}))}}(t,e,o,c),S(t,e,o,c),y(t,e,c),function(t,e,n,o){var r=Object.assign({},o),c=t.querySelector(r.deleteButton),a=document.querySelector("#delete-photo-card");!function(t,e,n){e._id===t.owner._id&&n.classList.add("photo-card__button-delete_visible")}(e,n,c),c.addEventListener("click",(function(){(function(t,e,n){t.querySelector(".popup__form").addEventListener("submit",(function(){!function(t,e){x(e._id).then((function(){!function(t){t.remove()}(t)})).catch((function(t){console.log(t)}))}(e,n),function(t){event.preventDefault(),l(t)}(t)}))})(a,t,e),d(a),u(a)}))}(t,e,o,c),function(t,e,n){var o=Object.assign({},n),r=document.querySelector(o.popupViewingPhoto);e.addEventListener("click",(function(){!function(t,e){var n=t.querySelector(".viewing-photo__image"),o=t.querySelector(".viewing-photo__figcaption");n.src=e.link,n.alt=e.name,o.textContent=e.name}(r,t),d(r),u(r)}))}(e,n,c)},q=function(t,e,n){var o=Object.assign({},n),r=function(t,e,n){var o=Object.assign({},n),r=document.querySelector("#photo-card-template").content.querySelector(o.cardItem).cloneNode(!0),c=r.querySelector(o.cardImage);return g(r,t,c,e,o),function(t,e,n,o){var r=Object.assign({},o);e.querySelector(r.cardTitle).textContent=n.name,t.src=n.link,t.alt=n.name}(c,r,t,o),r}(t,e,o);document.querySelector(o.photoCardPlace).append(r)},O=function(t,e,o){var r=Object.assign({},o),c=document.querySelector(r.popupAddPhoto),i=c.querySelector(".popup__form");(function(t,e,n,o){var r=Object.assign({},o);d(t),e.addEventListener("submit",(function(o){var c=e.querySelector(".popup__button"),a=c.textContent,i=e.querySelector(r.popupTitle),u=e.querySelector(r.popupImageLink),d={name:"".concat(i.value),link:"".concat(u.value)};o.preventDefault(),p(c),function(t,e,n,o,r,c){var a=Object.assign({},c);j(o).then((function(t){q(t,r,a)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t,s(n),l(n)}))}(a,c,t,d,n,r)}))})(c,i,e,r),function(t,e){document.querySelector(".profile__button-add").addEventListener("click",(function(){a(e,n),s(t),u(t)}))}(c,i),function(t,e,n){var o=Object.assign({},n);t.forEach((function(t){q(t,e,o)}))}(t,e,r)},E={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-4",headers:{authorization:"001ad720-6ef4-4b0d-b9d3-4ac6fa30aca0","Content-Type":"application/json"}},j=function(t){return fetch("".concat(E.baseUrl,"/cards"),{method:"POST",headers:E.headers,body:JSON.stringify({name:t.name,link:t.link})}).then(i)},C=function(t){return fetch("".concat(E.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:E.headers,body:JSON.stringify({avatar:"".concat(t.value)})}).then(i)},L=function(t,e){return fetch("".concat(E.baseUrl,"/users/me"),{method:"PATCH",headers:E.headers,body:JSON.stringify({name:"".concat(t.value),about:"".concat(e.value)})}).then(i)},k=function(t){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:E.headers}).then(i)},P=function(t){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:E.headers}).then(i)},x=function(t){return fetch("".concat(E.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:E.headers}).then((function(t){return!!t.ok||Promise.reject("Ошибка: ".concat(t.status))}))},A=function(){return fetch("".concat(E.baseUrl,"/cards"),{headers:E.headers}).then(i)};Promise.all([A(),fetch("".concat(E.baseUrl,"/users/me"),{headers:E.headers}).then(i)]).then((function(n){var o,r;o=n[0],r=n[1],m(r,t),b(r,t),O(o,r,e)})),r=n,function(t){var e=t.formSelector,n=function(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},c=Object.keys(t);for(o=0;o<c.length;o++)n=c[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(o=0;o<c.length;o++)n=c[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}(t,o);Array.from(document.querySelectorAll(e)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Object.assign({},e);Array.from(t.querySelectorAll(n.inputSelector)).forEach((function(e){e.addEventListener("input",(function(){(function(t,e,n){var o=Object.assign({},n),r=t.querySelector(".".concat(e.id,"-error"));e.validity.valid?c(e,r,o):function(t,e,n,o){var r=Object.assign({},o);t.classList.add(r.inputErrorClass),e.classList.add(r.errorClass),e.textContent=n}(e,r,e.validationMessage,o)})(t,e,n),a(t,n)}))}))}(t,n)}))}(Object.assign({},r))})();