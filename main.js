(()=>{"use strict";var t={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-4",headers:{authorization:"001ad720-6ef4-4b0d-b9d3-4ac6fa30aca0","Content-Type":"application/json"}},e={profileTitle:".profile__title",profileSubtitle:".profile__subtitle",profileEditButton:".profile__button-edit",popupProfile:"#add-profile",popupProfileTitle:"#popup-profile-title",popupProfileSubtitle:"#popup-profile-subtitle",avatarEditButton:".profile__photo-edit",avatarImage:".profile__photo",popupAvatar:"#update-avatar",popupAvatarTitle:"#popup-avatar-url"},o={cardItem:".photo-card",cardTitle:".photo-card__title",cardImage:".photo-card__image",heartButton:".photo-card__button-heart",heartCounter:".photo-card__heart-counter",deleteButton:".photo-card__button-delete",popupViewingPhoto:".viewing-photo",popupAddPhoto:"#add-photo-card",popupDeletePhoto:"#delete-photo-card",popupTitle:"#popup-photo-title ",popupImageLink:"#popup-photo-subtitle",photoCardPlace:".photo-grid__list"},n={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_visible"},r=["formSelector"];var c,a,i=function(t,e,o){var n=Object.assign({},o);t.classList.remove(n.inputErrorClass),e.classList.remove(n.errorClass),e.textContent=""},u=function(t,e){var o=Object.assign({},e),n=Array.from(t.querySelectorAll(o.inputSelector)),r=t.querySelector(o.submitButtonSelector);!function(t){return t.some((function(t){return!t.validity.valid}))}(n)?(r.removeAttribute("disabled"),r.classList.remove(o.inactiveButtonClass)):(r.setAttribute("disabled",!0),r.classList.add(o.inactiveButtonClass))},l=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",f),document.addEventListener("mousedown",v)},s=function(t){var e=t.querySelector(".popup__form");e.reset(),function(t,e){var o=Object.assign({},e);Array.from(t.querySelectorAll(o.inputSelector)).forEach((function(e){var n=t.querySelector(".".concat(e.id,"-error"));i(e,n,o)}))}(e,n)},p=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",f),document.removeEventListener("mousedown",v)},d=function(t){t.textContent="".concat(t.textContent,"...")},f=function(){"Escape"===event.key&&p(document.querySelector(".popup_opened"))},v=function(){event.target.classList.contains("popup_opened")&&p(document.querySelector(".popup_opened"))},h=function(t,e,o){e.textContent=t.name,o.textContent=t.about},m=function(t,e){var o=Object.assign({},e),r=document.querySelector(o.popupProfile),c=r.querySelector(".popup__form"),a=c.querySelector(o.popupProfileTitle),i=c.querySelector(o.popupProfileSubtitle),s=document.querySelector(o.profileTitle),f=document.querySelector(o.profileSubtitle);h(t,s,f),function(t,e,o,r,c,a,i){var s=Object.assign({},i);document.querySelector(s.profileEditButton).addEventListener("click",(function(){o.value=c.textContent,r.value=a.textContent,u(e,n),l(t)}))}(r,c,a,i,s,f,o),function(t,e,o,n,r,c){var a=e.querySelector(".popup__button"),i=a.textContent;e.addEventListener("submit",(function(e){!function(t,e,o,n,r,c,a){k(n,r).then((function(t){h(t,c,a),p(o)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t}))}(i,a,t,o,n,r,c),e.preventDefault(),d(a)}))}(r,c,a,i,s,f)},_=function(t,e){e.src=t.avatar},b=function(t,e){var o=Object.assign({},e),r=document.querySelector(o.popupAvatar),c=r.querySelector(".popup__form"),a=c.querySelector(o.popupAvatarTitle),i=document.querySelector(o.avatarImage);_(t,i),function(t,e,o){var r=Object.assign({},o);document.querySelector(r.avatarEditButton).addEventListener("click",(function(){u(e,n),s(t),l(t)}))}(r,c,o),function(t,e,o,n){var r=e.querySelector(".popup__button"),c=r.textContent;e.addEventListener("submit",(function(e){e.preventDefault(),function(t,e,o,n,r){L(n).then((function(t){_(t,r),s(o),p(o)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t}))}(c,r,t,o,n),d(r)}))}(r,c,a,i)},y={cardId:null,cardItem:null},S={},g=function(t,e,o){var n=Object.assign({},o),r=t.querySelector(n.heartCounter),c=e.likes.length;c>0?(r.classList.add("".concat(n.heartCounter,"_active")),r.textContent=c):(r.classList.remove("".concat(n.heartCounter,"_active")),r.textContent="")},q=function(t,e,o,n,r){var c=Object.assign({},r);!function(t,e,o,n){var r=Object.assign({},n);if(e.likes.length>0){var c=t.querySelector(r.heartButton);e.likes.forEach((function(t){t._id===o._id&&c.classList.add("photo-card__button-heart_active")}))}}(t,e,n,c),function(t,e,o,n){var r=Object.assign({},n),c=t.querySelector(r.heartButton);S[e._id]=e.likes,c.addEventListener("click",(function(){!function(t,e,o,n,r){var c=Object.assign({},r),a=S[e._id].some((function(t){return t._id===n._id}));a?function(t,e,o,n){var r=Object.assign({},n);x(e._id).then((function(n){S[e._id]=n.likes,g(o,n,r),t.classList.remove("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,o,c):function(t,e,o,n){var r=Object.assign({},n);P(e._id).then((function(n){S[e._id]=n.likes,g(o,n,r),t.classList.add("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,o,c)}(c,e,t,o,r)}))}(t,e,n,c),g(t,e,c),function(t,e,o,n){var r=Object.assign({},n),c=document.querySelector(r.popupDeletePhoto),a=t.querySelector(r.deleteButton);!function(t,e,o){e._id===t.owner._id&&o.classList.add("photo-card__button-delete_visible")}(e,o,a),a.addEventListener("click",(function(){y.cardId=e._id,y.cardItem=t,l(c)}))}(t,e,n,c),function(t,e,o){var n=Object.assign({},o),r=document.querySelector(n.popupViewingPhoto);e.addEventListener("click",(function(){!function(t,e){var o=t.querySelector(".viewing-photo__image"),n=t.querySelector(".viewing-photo__figcaption");o.src=e.link,o.alt=e.name,n.textContent=e.name}(r,t),l(r)}))}(e,o,c)},O=function(t,e,o){var n=Object.assign({},o),r=function(t,e,o){var n=Object.assign({},o),r=document.querySelector("#photo-card-template").content.querySelector(n.cardItem).cloneNode(!0),c=r.querySelector(n.cardImage);return q(r,t,c,e,n),function(t,e,o,n){var r=Object.assign({},n);e.querySelector(r.cardTitle).textContent=o.name,t.src=o.link,t.alt=o.name}(c,r,t,n),r}(t,e,n);document.querySelector(n.photoCardPlace).prepend(r)},C=function(t,e){var o=Object.assign({},e);!function(t){var e=t.querySelector(".popup__form"),o=e.querySelector(".popup__button"),n=o.textContent;e.addEventListener("submit",(function(e){e.preventDefault(),d(o),function(t,e,o,n,r){A(e).then((function(){delete S[e],o.remove(),p(t)})).catch((function(t){console.log(t)})).finally((function(){n.textContent=r}))}(t,y.cardId,y.cardItem,o,n),y.cardId=null,y.cardItem=null}))}(document.querySelector(o.popupDeletePhoto));var r,c=document.querySelector(o.popupAddPhoto);r=c,document.querySelector(".profile__button-add").addEventListener("click",(function(){s(r),l(r)})),function(t,e,o){var r=Object.assign({},o),c=t.querySelector(".popup__form"),a=c.querySelector(".popup__button"),i=a.textContent,l=c.querySelector(r.popupTitle),f=c.querySelector(r.popupImageLink);u(c,n),c.addEventListener("submit",(function(o){o.preventDefault();var n={name:"".concat(l.value),link:"".concat(f.value)};d(a),function(t,e,o,n,r,c){var a=Object.assign({},c);j(n).then((function(t){O(t,r,a),s(o),p(o)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t}))}(i,a,t,n,e,r)}))}(c,t,o)},E=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},j=function(e){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(E)},L=function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:"".concat(e.value)})}).then(E)},k=function(e,o){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:"".concat(e.value),about:"".concat(o.value)})}).then(E)},P=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then(E)},x=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then(E)},A=function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(t){return!!t.ok||Promise.reject("Ошибка: ".concat(t.status))}))};Promise.all([fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(E),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(E)]).then((function(t){var n,r;n=t[0],r=t[1],m(r,e),b(r,e),function(t,e,o){var n=Object.assign({},o);C(e,n),function(t,e,o){var n=Object.assign({},o);t.forEach((function(t){O(t,e,n)}))}(t,e,n)}(n,r,o)})),(c=Array.from(document.querySelectorAll(".popup"))).push(document.querySelector(".viewing-photo")),c.forEach((function(t){!function(t){t.querySelector(".popup__close-button").addEventListener("click",(function(){p(t)}))}(t)})),a=n,function(t){var e=t.formSelector,o=function(t,e){if(null==t)return{};var o,n,r=function(t,e){if(null==t)return{};var o,n,r={},c=Object.keys(t);for(n=0;n<c.length;n++)o=c[n],e.indexOf(o)>=0||(r[o]=t[o]);return r}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(n=0;n<c.length;n++)o=c[n],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(r[o]=t[o])}return r}(t,r);Array.from(document.querySelectorAll(e)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var o=Object.assign({},e);Array.from(t.querySelectorAll(o.inputSelector)).forEach((function(e){e.addEventListener("input",(function(){(function(t,e,o){var n=Object.assign({},o),r=t.querySelector(".".concat(e.id,"-error"));e.validity.valid?i(e,r,n):function(t,e,o,n){var r=Object.assign({},n);t.classList.add(r.inputErrorClass),e.classList.add(r.errorClass),e.textContent=o}(e,r,e.validationMessage,n)})(t,e,o),u(t,o)}))}))}(t,o)}))}(Object.assign({},a))})();