(()=>{"use strict";var t={profileTitle:".profile__title",profileSubtitle:".profile__subtitle",profileEditButton:".profile__button-edit",popupProfile:"#add-profile",popupProfileTitle:"#popup-profile-title",popupProfileSubtitle:"#popup-profile-subtitle",avatarEditButton:".profile__photo-edit",avatarImage:".profile__photo",popupAvatar:"#update-avatar",popupAvatarTitle:"#popup-avatar-url"},e={cardItem:".photo-card",cardTitle:".photo-card__title",cardImage:".photo-card__image",heartButton:".photo-card__button-heart",heartCounter:".photo-card__heart-counter",deleteButton:".photo-card__button-delete",popupViewingPhoto:".viewing-photo",popupAddPhoto:"#add-photo-card",popupDeletePhoto:"#delete-photo-card",popupTitle:"#popup-photo-title ",popupImageLink:"#popup-photo-subtitle",photoCardPlace:".photo-grid__list"},o={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_visible"},n=["formSelector"];var r,c=function(t,e,o){var n=Object.assign({},o);t.classList.remove(n.inputErrorClass),e.classList.remove(n.errorClass),e.textContent=""},a=function(t,e){var o=Object.assign({},e),n=Array.from(t.querySelectorAll(o.inputSelector)),r=t.querySelector(o.submitButtonSelector);!function(t){return t.some((function(t){return!t.validity.valid}))}(n)?(r.removeAttribute("disabled"),r.classList.remove(o.inactiveButtonClass)):(r.setAttribute("disabled",!0),r.classList.add(o.inactiveButtonClass))},i=function(t,e){var o=Object.assign({},e);Array.from(t.querySelectorAll(o.inputSelector)).forEach((function(e){var n=t.querySelector(".".concat(e.id,"-error"));c(e,n,o)}))},u=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",d),t.addEventListener("mousedown",f)},l=function(t){var e=t.querySelector(".popup__form");e.reset(),i(e,o),a(e,o)},s=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",d),t.removeEventListener("mousedown",f)},p=function(t){t.textContent="".concat(t.textContent,"...")},d=function(t){"Escape"===t.key&&s(document.querySelector(".popup_opened"))},f=function(t){s(t.target)},v={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-4",headers:{authorization:"001ad720-6ef4-4b0d-b9d3-4ac6fa30aca0","Content-Type":"application/json"}},h=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},m=function(t,e,o){e.textContent=t.name,o.textContent=t.about},_=function(t,e){var n=Object.assign({},e),r=document.querySelector(n.popupProfile),c=r.querySelector(".popup__form"),l=c.querySelector(n.popupProfileTitle),d=c.querySelector(n.popupProfileSubtitle),f=document.querySelector(n.profileTitle),_=document.querySelector(n.profileSubtitle);m(t,f,_),function(t,e,n,r,c,l,s){var p=Object.assign({},s);document.querySelector(p.profileEditButton).addEventListener("click",(function(){n.value=c.textContent,r.value=l.textContent,i(e,o),a(e,o),u(t)}))}(r,c,l,d,f,_,n),function(t,e,o,n,r,c){var a=e.querySelector(".popup__button"),i=a.textContent;e.addEventListener("submit",(function(e){(function(t,e,o,n,r,c,a){(function(t,e){return fetch("".concat(v.baseUrl,"/users/me"),{method:"PATCH",headers:v.headers,body:JSON.stringify({name:"".concat(t.value),about:"".concat(e.value)})}).then(h)})(n,r).then((function(t){m(t,c,a),s(o)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t}))})(i,a,t,o,n,r,c),e.preventDefault(),p(a)}))}(r,c,l,d,f,_)},b=function(t,e){e.src=t.avatar},y=function(t,e){var o=Object.assign({},e),n=document.querySelector(o.popupAvatar),r=n.querySelector(".popup__form"),c=r.querySelector(o.popupAvatarTitle),a=document.querySelector(o.avatarImage);b(t,a),function(t,e){var o=Object.assign({},e);document.querySelector(o.avatarEditButton).addEventListener("click",(function(){l(t),u(t)}))}(n,o),function(t,e,o,n){var r=e.querySelector(".popup__button"),c=r.textContent;e.addEventListener("submit",(function(e){e.preventDefault(),function(t,e,o,n,r){(function(t){return fetch("".concat(v.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:v.headers,body:JSON.stringify({avatar:"".concat(t.value)})}).then(h)})(n).then((function(t){b(t,r),s(o)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t}))}(c,r,t,o,n),p(r)}))}(n,r,c,a)},S={cardId:null,cardItem:null},g={},q=function(t,e,o){var n=Object.assign({},o),r=t.querySelector(n.heartCounter),c=e.likes.length;c>0?(r.classList.add("".concat(n.heartCounter,"_active")),r.textContent=c):(r.classList.remove("".concat(n.heartCounter,"_active")),r.textContent="")},O=function(t,e,o,n){var r=Object.assign({},n),c=t.querySelector(r.heartButton);g[e._id]=e.likes,c.addEventListener("click",(function(){!function(t,e,o,n,r){var c=Object.assign({},r),a=g[e._id].some((function(t){return t._id===n._id}));a?function(t,e,o,n){var r,c=Object.assign({},n);(r=e._id,fetch("".concat(v.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:v.headers}).then(h)).then((function(n){g[e._id]=n.likes,q(o,n,c),t.classList.remove("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,o,c):function(t,e,o,n){var r,c=Object.assign({},n);(r=e._id,fetch("".concat(v.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:v.headers}).then(h)).then((function(n){g[e._id]=n.likes,q(o,n,c),t.classList.add("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,o,c)}(c,e,t,o,r)}))},C=function(t){var e=t.querySelector(".popup__form"),o=e.querySelector(".popup__button"),n=o.textContent;e.addEventListener("submit",(function(e){e.preventDefault(),p(o),function(t,e,o,n,r){(function(t){return fetch("".concat(v.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:v.headers}).then(h)})(e).then((function(){delete g[e],o.remove(),s(t)})).catch((function(t){console.log(t)})).finally((function(){n.textContent=r}))}(t,S.cardId,S.cardItem,o,n),S.cardId=null,S.cardItem=null}))},E=function(t,e,o){var n=Object.assign({},o),r=document.querySelector("#photo-card-template").content.querySelector(n.cardItem).cloneNode(!0),c=r.querySelector(n.cardImage);return function(t,e,o,n,r){var c=Object.assign({},r);!function(t,e,o,n){var r=Object.assign({},n);if(e.likes.length>0){var c=t.querySelector(r.heartButton);e.likes.forEach((function(t){t._id===o._id&&c.classList.add("photo-card__button-heart_active")}))}}(t,e,n,c),O(t,e,n,c),q(t,e,c),function(t,e,o,n){var r=Object.assign({},n),c=document.querySelector(r.popupDeletePhoto),a=t.querySelector(r.deleteButton);!function(t,e,o){e._id===t.owner._id&&o.classList.add("photo-card__button-delete_visible")}(e,o,a),a.addEventListener("click",(function(){S.cardId=e._id,S.cardItem=t,u(c)}))}(t,e,n,c),function(t,e,o){var n=Object.assign({},o),r=document.querySelector(n.popupViewingPhoto);e.addEventListener("click",(function(){!function(t,e){var o=t.querySelector(".viewing-photo__image"),n=t.querySelector(".viewing-photo__figcaption");o.src=e.link,o.alt=e.name,n.textContent=e.name}(r,t),u(r)}))}(e,o,c)}(r,t,c,e,n),function(t,e,o,n){var r=Object.assign({},n);e.querySelector(r.cardTitle).textContent=o.name,t.src=o.link,t.alt=o.name}(c,r,t,n),r},j=function(t,e,o){var n=Object.assign({},o),r=E(t,e,n);document.querySelector(n.photoCardPlace).prepend(r)},L=function(t,e){var o=Object.assign({},e),n=document.querySelector(o.popupDeletePhoto);C(n);var r,c=document.querySelector(o.popupAddPhoto);r=c,document.querySelector(".profile__button-add").addEventListener("click",(function(){l(r),u(r)})),function(t,e,o){var n=Object.assign({},o),r=t.querySelector(".popup__form"),c=r.querySelector(".popup__button"),a=c.textContent,i=r.querySelector(n.popupTitle),u=r.querySelector(n.popupImageLink);r.addEventListener("submit",(function(o){o.preventDefault();var r={name:"".concat(i.value),link:"".concat(u.value)};p(c),function(t,e,o,n,r,c){var a,i=Object.assign({},c);(a=n,fetch("".concat(v.baseUrl,"/cards"),{method:"POST",headers:v.headers,body:JSON.stringify({name:a.name,link:a.link})}).then(h)).then((function(t){j(t,r,i),s(o)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t}))}(a,c,t,r,e,n)}))}(c,t,o)};Array.from(document.querySelectorAll(".popup")).forEach((function(t){!function(t){t.querySelector(".popup__close-button").addEventListener("click",(function(){s(t)}))}(t)})),r=o,function(t){var e=t.formSelector,o=function(t,e){if(null==t)return{};var o,n,r=function(t,e){if(null==t)return{};var o,n,r={},c=Object.keys(t);for(n=0;n<c.length;n++)o=c[n],e.indexOf(o)>=0||(r[o]=t[o]);return r}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(n=0;n<c.length;n++)o=c[n],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(r[o]=t[o])}return r}(t,n);Array.from(document.querySelectorAll(e)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var o=Object.assign({},e);Array.from(t.querySelectorAll(o.inputSelector)).forEach((function(e){e.addEventListener("input",(function(){(function(t,e,o){var n=Object.assign({},o),r=t.querySelector(".".concat(e.id,"-error"));e.validity.valid?c(e,r,n):function(t,e,o,n){var r=Object.assign({},n);t.classList.add(r.inputErrorClass),e.classList.add(r.errorClass),e.textContent=o}(e,r,e.validationMessage,n)})(t,e,o),a(t,o)}))}))}(t,o)}))}(Object.assign({},r)),Promise.all([fetch("".concat(v.baseUrl,"/cards"),{headers:v.headers}).then(h),fetch("".concat(v.baseUrl,"/users/me"),{headers:v.headers}).then(h)]).then((function(o){var n,r;n=o[0],r=o[1],_(r,t),y(r,t),function(t,e,o){var n=Object.assign({},o);L(e,n),function(t,e,o){var n=Object.assign({},o);t.forEach((function(t){j(t,e,n)}))}(t,e,n)}(n,r,e)})).catch((function(t){console.log(t)}))})();