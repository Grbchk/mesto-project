(()=>{"use strict";var t={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-4",headers:{authorization:"001ad720-6ef4-4b0d-b9d3-4ac6fa30aca0","Content-Type":"application/json"}},e={profileTitle:".profile__title",profileSubtitle:".profile__subtitle",profileEditButton:".profile__button-edit",popupProfile:"#add-profile",popupProfileTitle:"#popup-profile-title",popupProfileSubtitle:"#popup-profile-subtitle",avatarEditButton:".profile__photo-edit",avatarImage:".profile__photo",popupAvatar:"#update-avatar",popupAvatarTitle:"#popup-avatar-url"},n={cardItem:".photo-card",cardTitle:".photo-card__title",cardImage:".photo-card__image",heartButton:".photo-card__button-heart",heartCounter:".photo-card__heart-counter",deleteButton:".photo-card__button-delete",popupViewingPhoto:".viewing-photo",popupAddPhoto:"#add-photo-card",popupTitle:"#popup-photo-title ",popupImageLink:"#popup-photo-subtitle",photoCardPlace:".photo-grid__list"},o={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_visible"},r=["formSelector"];var c,a,i=function(t,e,n){var o=Object.assign({},n);t.classList.remove(o.inputErrorClass),e.classList.remove(o.errorClass),e.textContent=""},u=function(t,e){var n=Object.assign({},e),o=Array.from(t.querySelectorAll(n.inputSelector)),r=t.querySelector(n.submitButtonSelector);!function(t){return t.some((function(t){return!t.validity.valid}))}(o)?(r.removeAttribute("disabled"),r.classList.remove(n.inactiveButtonClass)):(r.setAttribute("disabled",!0),r.classList.add(n.inactiveButtonClass))},s=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",f),document.addEventListener("mousedown",v)},l=function(t){var e=t.querySelector(".popup__form");e.reset(),function(t,e){var n=Object.assign({},e);Array.from(t.querySelectorAll(n.inputSelector)).forEach((function(e){var o=t.querySelector(".".concat(e.id,"-error"));i(e,o,n)}))}(e,o)},p=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",f),document.removeEventListener("mousedown",v)},d=function(t){t.textContent="".concat(t.textContent,"...")},f=function(){"Escape"===event.key&&p(document.querySelector(".popup_opened"))},v=function(){event.target.classList.contains("popup_opened")&&p(document.querySelector(".popup_opened"))},h=function(t,e,n){e.textContent=t.name,n.textContent=t.about},m=function(t,e){var n=Object.assign({},e),r=document.querySelector(n.popupProfile),c=r.querySelector(".popup__form"),a=c.querySelector(n.popupProfileTitle),i=c.querySelector(n.popupProfileSubtitle),l=document.querySelector(n.profileTitle),f=document.querySelector(n.profileSubtitle);h(t,l,f),function(t,e,n,r,c,a,i){var l=Object.assign({},i);document.querySelector(l.profileEditButton).addEventListener("click",(function(){n.value=c.textContent,r.value=a.textContent,u(e,o),s(t)}))}(r,c,a,i,l,f,n),function(t,e,n,o,r,c){e.addEventListener("submit",(function(a){var i=e.querySelector(".popup__button");!function(t,e,n,o,r,c,a){L(o,r).then((function(t){h(t,c,a)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t,p(n)}))}(i.textContent,i,t,n,o,r,c),a.preventDefault(),d(i)}))}(r,c,a,i,l,f)},_=function(t,e){e.src=t.avatar},b=function(t,e){var n=Object.assign({},e),r=document.querySelector(n.popupAvatar),c=r.querySelector(".popup__form"),a=c.querySelector(n.popupAvatarTitle),i=document.querySelector(n.avatarImage);_(t,i),function(t,e,n){var r=Object.assign({},n);document.querySelector(r.avatarEditButton).addEventListener("click",(function(){u(e,o),l(t),s(t)}))}(r,c,n),function(t,e,n,o){e.addEventListener("submit",(function(r){var c=e.querySelector(".popup__button");!function(t,e,n,o,r){C(o).then((function(t){_(t,r)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t,l(n),p(n)}))}(c.textContent,c,t,n,o),r.preventDefault(),d(c)}))}(r,c,a,i)},y=function(t,e,n){var o=Object.assign({},n),r=t.querySelector(o.heartCounter),c=e.likes.length;c>0?(r.classList.add("".concat(o.heartCounter,"_active")),r.textContent=c):(r.classList.remove("".concat(o.heartCounter,"_active")),r.textContent="")},S=function(t,e,n,o){var r=Object.assign({},o);t.querySelector(r.heartButton).addEventListener("click",(function(o){!function(t,e,n,o,r){var c=Object.assign({},r);A().then((function(r){var a=r.filter((function(t){if(t._id===e._id)return t}));!function(t,e,n,o,r){var c=Object.assign({},r);e.likes.some((function(t){return t._id===o._id}))?function(t,e,n,o){var r=Object.assign({},o);P(e._id).then((function(e){y(n,e,r),t.classList.remove("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,n,c):function(t,e,n,o){var r=Object.assign({},o);k(e._id).then((function(e){y(n,e,r),t.classList.add("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,n,c)}(t,a[0],n,o,c)})).catch((function(t){console.log(t)}))}(o.target,e,t,n,r)}))},g=function(t,e,n,o,r){var c=Object.assign({},r);!function(t,e,n,o){var r=Object.assign({},o);if(e.likes.length>0){var c=t.querySelector(r.heartButton);e.likes.forEach((function(t){t._id===n._id&&c.classList.add("photo-card__button-heart_active")}))}}(t,e,o,c),S(t,e,o,c),y(t,e,c),function(t,e,n,o){var r=Object.assign({},o),c=t.querySelector(r.deleteButton),a=document.querySelector("#delete-photo-card");!function(t,e,n){e._id===t.owner._id&&n.classList.add("photo-card__button-delete_visible")}(e,n,c),c.addEventListener("click",(function(){(function(t,e,n){t.querySelector(".popup__form").addEventListener("submit",(function(){!function(t,e){x(e._id).then((function(){!function(t){t.remove()}(t)})).catch((function(t){console.log(t)}))}(e,n),function(t){event.preventDefault(),p(t)}(t)}))})(a,t,e),s(a)}))}(t,e,o,c),function(t,e,n){var o=Object.assign({},n),r=document.querySelector(o.popupViewingPhoto);e.addEventListener("click",(function(){!function(t,e){var n=t.querySelector(".viewing-photo__image"),o=t.querySelector(".viewing-photo__figcaption");n.src=e.link,n.alt=e.name,o.textContent=e.name}(r,t),s(r)}))}(e,n,c)},q=function(t,e,n){var o=Object.assign({},n),r=function(t,e,n){var o=Object.assign({},n),r=document.querySelector("#photo-card-template").content.querySelector(o.cardItem).cloneNode(!0),c=r.querySelector(o.cardImage);return g(r,t,c,e,o),function(t,e,n,o){var r=Object.assign({},o);e.querySelector(r.cardTitle).textContent=n.name,t.src=n.link,t.alt=n.name}(c,r,t,o),r}(t,e,o);document.querySelector(o.photoCardPlace).prepend(r)},O=function(t,e,n){var r=Object.assign({},n),c=document.querySelector(r.popupAddPhoto),a=c.querySelector(".popup__form");(function(t,e,n,o){var r=Object.assign({},o);e.addEventListener("submit",(function(o){var c=e.querySelector(".popup__button"),a=c.textContent,i=e.querySelector(r.popupTitle),u=e.querySelector(r.popupImageLink),s={name:"".concat(i.value),link:"".concat(u.value)};o.preventDefault(),d(c),function(t,e,n,o,r,c){var a=Object.assign({},c);j(o).then((function(t){q(t,r,a)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t,l(n),p(n)}))}(a,c,t,s,n,r)}))})(c,a,e,r),function(t,e){document.querySelector(".profile__button-add").addEventListener("click",(function(){u(e,o),l(t),s(t)}))}(c,a),function(t,e,n){var o=Object.assign({},n);t.forEach((function(t){q(t,e,o)}))}(t,e,r)},E=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},j=function(e){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(E)},C=function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:"".concat(e.value)})}).then(E)},L=function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:"".concat(e.value),about:"".concat(n.value)})}).then(E)},k=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then(E)},P=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then(E)},x=function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(t){return!!t.ok||Promise.reject("Ошибка: ".concat(t.status))}))},A=function(){return fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(E)};Promise.all([A(),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(E)]).then((function(t){var o,r;o=t[0],r=t[1],m(r,e),b(r,e),O(o,r,n)})),(c=Array.from(document.querySelectorAll(".popup"))).push(document.querySelector(".viewing-photo")),c.forEach((function(t){!function(t){t.querySelector(".popup__close-button").addEventListener("click",(function(){p(t)}))}(t)})),a=o,function(t){var e=t.formSelector,n=function(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},c=Object.keys(t);for(o=0;o<c.length;o++)n=c[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(o=0;o<c.length;o++)n=c[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}(t,r);Array.from(document.querySelectorAll(e)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Object.assign({},e);Array.from(t.querySelectorAll(n.inputSelector)).forEach((function(e){e.addEventListener("input",(function(){(function(t,e,n){var o=Object.assign({},n),r=t.querySelector(".".concat(e.id,"-error"));e.validity.valid?i(e,r,o):function(t,e,n,o){var r=Object.assign({},o);t.classList.add(r.inputErrorClass),e.classList.add(r.errorClass),e.textContent=n}(e,r,e.validationMessage,o)})(t,e,n),u(t,n)}))}))}(t,n)}))}(Object.assign({},a))})();