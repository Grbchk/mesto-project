(()=>{"use strict";var t={profileTitle:".profile__title",profileSubtitle:".profile__subtitle",profileEditButton:".profile__button-edit",popupProfile:"#add-profile",popupProfileTitle:"#popup-profile-title",popupProfileSubtitle:"#popup-profile-subtitle",avatarEditButton:".profile__photo-edit",avatarImage:".profile__photo",popupAvatar:"#update-avatar",popupAvatarTitle:"#popup-avatar-url"},e={cardItem:".photo-card",cardTitle:".photo-card__title",cardImage:".photo-card__image",heartButton:".photo-card__button-heart",heartCounter:".photo-card__heart-counter",deleteButton:".photo-card__button-delete",popupViewingPhoto:".viewing-photo",popupAddPhoto:"#add-photo-card",popupDeletePhoto:"#delete-photo-card",popupTitle:"#popup-photo-title ",popupImageLink:"#popup-photo-subtitle",photoCardPlace:".photo-grid__list"},o={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_visible"},n=["formSelector"];var r,c=function(t,e,o){var n=Object.assign({},o);t.classList.remove(n.inputErrorClass),e.classList.remove(n.errorClass),e.textContent=""},a=function(t,e){var o=Object.assign({},e),n=Array.from(t.querySelectorAll(o.inputSelector)),r=t.querySelector(o.submitButtonSelector);!function(t){return t.some((function(t){return!t.validity.valid}))}(n)?(r.removeAttribute("disabled"),r.classList.remove(o.inactiveButtonClass)):(r.setAttribute("disabled",!0),r.classList.add(o.inactiveButtonClass))},i=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",p),t.addEventListener("mousedown",d)},u=function(t){var e=t.querySelector(".popup__form");e.reset(),function(t,e){var o=Object.assign({},e);Array.from(t.querySelectorAll(o.inputSelector)).forEach((function(e){var n=t.querySelector(".".concat(e.id,"-error"));c(e,n,o)}))}(e,o)},l=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",p),t.removeEventListener("mousedown",d)},s=function(t){t.textContent="".concat(t.textContent,"...")},p=function(t){"Escape"===t.key&&l(document.querySelector(".popup_opened"))},d=function(t){l(t.target)},f={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-4",headers:{authorization:"001ad720-6ef4-4b0d-b9d3-4ac6fa30aca0","Content-Type":"application/json"}},v=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},h=function(t,e,o){e.textContent=t.name,o.textContent=t.about},m=function(t,e){var n=Object.assign({},e),r=document.querySelector(n.popupProfile),c=r.querySelector(".popup__form"),u=c.querySelector(n.popupProfileTitle),p=c.querySelector(n.popupProfileSubtitle),d=document.querySelector(n.profileTitle),m=document.querySelector(n.profileSubtitle);h(t,d,m),function(t,e,n,r,c,u,l){var s=Object.assign({},l);document.querySelector(s.profileEditButton).addEventListener("click",(function(){n.value=c.textContent,r.value=u.textContent,a(e,o),i(t)}))}(r,c,u,p,d,m,n),function(t,e,o,n,r,c){var a=e.querySelector(".popup__button"),i=a.textContent;e.addEventListener("submit",(function(e){(function(t,e,o,n,r,c,a){(function(t,e){return fetch("".concat(f.baseUrl,"/users/me"),{method:"PATCH",headers:f.headers,body:JSON.stringify({name:"".concat(t.value),about:"".concat(e.value)})}).then(v)})(n,r).then((function(t){h(t,c,a),l(o)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t}))})(i,a,t,o,n,r,c),e.preventDefault(),s(a)}))}(r,c,u,p,d,m)},_=function(t,e){e.src=t.avatar},b=function(t,e){var n=Object.assign({},e),r=document.querySelector(n.popupAvatar),c=r.querySelector(".popup__form"),p=c.querySelector(n.popupAvatarTitle),d=document.querySelector(n.avatarImage);_(t,d),function(t,e,n){var r=Object.assign({},n);document.querySelector(r.avatarEditButton).addEventListener("click",(function(){a(e,o),u(t),i(t)}))}(r,c,n),function(t,e,o,n){var r=e.querySelector(".popup__button"),c=r.textContent;e.addEventListener("submit",(function(e){e.preventDefault(),function(t,e,o,n,r){(function(t){return fetch("".concat(f.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:f.headers,body:JSON.stringify({avatar:"".concat(t.value)})}).then(v)})(n).then((function(t){_(t,r),u(o),l(o)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t}))}(c,r,t,o,n),s(r)}))}(r,c,p,d)},y={cardId:null,cardItem:null},S={},g=function(t,e,o){var n=Object.assign({},o),r=t.querySelector(n.heartCounter),c=e.likes.length;c>0?(r.classList.add("".concat(n.heartCounter,"_active")),r.textContent=c):(r.classList.remove("".concat(n.heartCounter,"_active")),r.textContent="")},q=function(t,e,o,n){var r=Object.assign({},n),c=t.querySelector(r.heartButton);S[e._id]=e.likes,c.addEventListener("click",(function(){!function(t,e,o,n,r){var c=Object.assign({},r),a=S[e._id].some((function(t){return t._id===n._id}));a?function(t,e,o,n){var r,c=Object.assign({},n);(r=e._id,fetch("".concat(f.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:f.headers}).then(v)).then((function(n){S[e._id]=n.likes,g(o,n,c),t.classList.remove("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,o,c):function(t,e,o,n){var r,c=Object.assign({},n);(r=e._id,fetch("".concat(f.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:f.headers}).then(v)).then((function(n){S[e._id]=n.likes,g(o,n,c),t.classList.add("photo-card__button-heart_active")})).catch((function(t){console.log(t)}))}(t,e,o,c)}(c,e,t,o,r)}))},O=function(t){var e=t.querySelector(".popup__form"),o=e.querySelector(".popup__button"),n=o.textContent;e.addEventListener("submit",(function(e){e.preventDefault(),s(o),function(t,e,o,n,r){(function(t){return fetch("".concat(f.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:f.headers}).then(v)})(e).then((function(){delete S[e],o.remove(),l(t)})).catch((function(t){console.log(t)})).finally((function(){n.textContent=r}))}(t,y.cardId,y.cardItem,o,n),y.cardId=null,y.cardItem=null}))},C=function(t,e,o){var n=Object.assign({},o),r=document.querySelector("#photo-card-template").content.querySelector(n.cardItem).cloneNode(!0),c=r.querySelector(n.cardImage);return function(t,e,o,n,r){var c=Object.assign({},r);!function(t,e,o,n){var r=Object.assign({},n);if(e.likes.length>0){var c=t.querySelector(r.heartButton);e.likes.forEach((function(t){t._id===o._id&&c.classList.add("photo-card__button-heart_active")}))}}(t,e,n,c),q(t,e,n,c),g(t,e,c),function(t,e,o,n){var r=Object.assign({},n),c=document.querySelector(r.popupDeletePhoto),a=t.querySelector(r.deleteButton);!function(t,e,o){e._id===t.owner._id&&o.classList.add("photo-card__button-delete_visible")}(e,o,a),a.addEventListener("click",(function(){y.cardId=e._id,y.cardItem=t,i(c)}))}(t,e,n,c),function(t,e,o){var n=Object.assign({},o),r=document.querySelector(n.popupViewingPhoto);e.addEventListener("click",(function(){!function(t,e){var o=t.querySelector(".viewing-photo__image"),n=t.querySelector(".viewing-photo__figcaption");o.src=e.link,o.alt=e.name,n.textContent=e.name}(r,t),i(r)}))}(e,o,c)}(r,t,c,e,n),function(t,e,o,n){var r=Object.assign({},n);e.querySelector(r.cardTitle).textContent=o.name,t.src=o.link,t.alt=o.name}(c,r,t,n),r},E=function(t,e,o){var n=Object.assign({},o),r=C(t,e,n);document.querySelector(n.photoCardPlace).prepend(r)},j=function(t,e){var n=Object.assign({},e),r=document.querySelector(n.popupDeletePhoto);O(r);var c,p=document.querySelector(n.popupAddPhoto);c=p,document.querySelector(".profile__button-add").addEventListener("click",(function(){u(c),i(c)})),function(t,e,n){var r=Object.assign({},n),c=t.querySelector(".popup__form"),i=c.querySelector(".popup__button"),p=i.textContent,d=c.querySelector(r.popupTitle),h=c.querySelector(r.popupImageLink);a(c,o),c.addEventListener("submit",(function(o){o.preventDefault();var n={name:"".concat(d.value),link:"".concat(h.value)};s(i),function(t,e,o,n,r,c){var a,i=Object.assign({},c);(a=n,fetch("".concat(f.baseUrl,"/cards"),{method:"POST",headers:f.headers,body:JSON.stringify({name:a.name,link:a.link})}).then(v)).then((function(t){E(t,r,i),u(o),l(o)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=t}))}(p,i,t,n,e,r)}))}(p,t,n)};Array.from(document.querySelectorAll(".popup")).forEach((function(t){!function(t){t.querySelector(".popup__close-button").addEventListener("click",(function(){l(t)}))}(t)})),r=o,function(t){var e=t.formSelector,o=function(t,e){if(null==t)return{};var o,n,r=function(t,e){if(null==t)return{};var o,n,r={},c=Object.keys(t);for(n=0;n<c.length;n++)o=c[n],e.indexOf(o)>=0||(r[o]=t[o]);return r}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(n=0;n<c.length;n++)o=c[n],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(r[o]=t[o])}return r}(t,n);Array.from(document.querySelectorAll(e)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var o=Object.assign({},e);Array.from(t.querySelectorAll(o.inputSelector)).forEach((function(e){e.addEventListener("input",(function(){(function(t,e,o){var n=Object.assign({},o),r=t.querySelector(".".concat(e.id,"-error"));e.validity.valid?c(e,r,n):function(t,e,o,n){var r=Object.assign({},n);t.classList.add(r.inputErrorClass),e.classList.add(r.errorClass),e.textContent=o}(e,r,e.validationMessage,n)})(t,e,o),a(t,o)}))}))}(t,o)}))}(Object.assign({},r)),Promise.all([fetch("".concat(f.baseUrl,"/cards"),{headers:f.headers}).then(v),fetch("".concat(f.baseUrl,"/users/me"),{headers:f.headers}).then(v)]).then((function(o){var n,r;n=o[0],r=o[1],m(r,t),b(r,t),function(t,e,o){var n=Object.assign({},o);j(e,n),function(t,e,o){var n=Object.assign({},o);t.forEach((function(t){E(t,e,n)}))}(t,e,n)}(n,r,e)}))})();